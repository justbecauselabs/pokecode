#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# React Native text validation pre-commit hook
echo "ğŸ” Running React Native text validation..."

# Check for potential raw text issues using grep
if grep -r --include="*.tsx" --include="*.ts" -E '\{[^<}]*["\'][^"\']*["\'][^}]*\}' mobile/src/ mobile/app/ | grep -v 'Text\|text\|className\|style\|key\|testID' > /tmp/potential-raw-text.log 2>/dev/null; then
  echo "âš ï¸  Potential raw text found that might cause React Native errors:"
  cat /tmp/potential-raw-text.log
  echo ""
  echo "ğŸ’¡ Make sure all text content is wrapped in <Text> components!"
  echo "   Example: <Text>{someString}</Text>"
  echo ""
fi

# Run ESLint for React Native rules
echo "ğŸ”§ Running React Native ESLint checks..."
cd mobile
if ! bunx eslint . --ext .tsx,.ts --max-warnings 0; then
  echo "âŒ ESLint React Native checks failed!"
  echo "Run 'bun run lint:rn:fix' to automatically fix issues"
  exit 1
fi

# Run TypeScript check
echo "ğŸ“ Running TypeScript checks..."
if ! bunx tsc --noEmit; then
  echo "âŒ TypeScript checks failed!"
  exit 1
fi

echo "âœ… All checks passed!"